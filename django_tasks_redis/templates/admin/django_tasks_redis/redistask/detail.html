{% extends "admin/base_site.html" %}
{% load i18n %}

{% block title %}{% trans "Task Detail" %} | {{ block.super }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans "Home" %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_label|capfirst }}</a>
    &rsaquo; <a href="{% url 'admin:django_tasks_redis_redistask_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
    &rsaquo; {% trans "Task Detail" %}
</div>
{% endblock %}

{% block content %}
<style>
    .task-detail {
        background: var(--body-bg, #fff);
        padding: 20px;
        border: 1px solid var(--border-color, #e8e8e8);
        margin-bottom: 20px;
    }
    .task-detail h2 {
        margin-top: 20px;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--hairline-color, #e8e8e8);
        color: var(--body-fg, #333);
        font-size: 16px;
        font-weight: 600;
    }
    .task-detail h2:first-child {
        margin-top: 0;
    }
    .task-detail table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        background: var(--darkened-bg, #f8f8f8);
    }
    .task-detail th {
        text-align: left;
        padding: 10px 15px;
        background: var(--darkened-bg, #f8f8f8);
        border-bottom: 1px solid var(--hairline-color, #e8e8e8);
        color: var(--body-quiet-color, #666);
        font-weight: 600;
        width: 180px;
        vertical-align: top;
    }
    .task-detail td {
        padding: 10px 15px;
        border-bottom: 1px solid var(--hairline-color, #e8e8e8);
        background: var(--body-bg, #fff);
        color: var(--body-fg, #333);
    }
    .task-detail code {
        background: var(--darkened-bg, #f8f8f8);
        padding: 2px 6px;
        border-radius: 3px;
        font-family: Consolas, Monaco, "Courier New", monospace;
        font-size: 12px;
        color: var(--body-fg, #333);
    }
    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .status-READY {
        background-color: #6c757d;
        color: white;
    }
    .status-RUNNING {
        background-color: #007bff;
        color: white;
    }
    .status-SUCCESSFUL {
        background-color: #28a745;
        color: white;
    }
    .status-FAILED {
        background-color: var(--error-fg, #ba2121);
        color: white;
    }
    .json-content {
        background: var(--darkened-bg, #f8f8f8);
        border: 1px solid var(--border-color, #e8e8e8);
        padding: 12px;
        border-radius: 4px;
        font-family: Consolas, Monaco, "Courier New", monospace;
        font-size: 12px;
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: 300px;
        overflow-y: auto;
        color: var(--body-fg, #333);
    }
    .error-content {
        background: var(--message-error-bg, #ffefef);
        border: 1px solid var(--error-fg, #ba2121);
        padding: 12px;
        border-radius: 4px;
        font-family: Consolas, Monaco, "Courier New", monospace;
        font-size: 12px;
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: 300px;
        overflow-y: auto;
        color: var(--error-fg, #ba2121);
    }
    .empty-value {
        color: var(--body-quiet-color, #999);
        font-style: italic;
    }
    .not-found {
        text-align: center;
        padding: 60px 20px;
        background: var(--darkened-bg, #f8f8f8);
        border: 1px solid var(--border-color, #e8e8e8);
        border-radius: 4px;
    }
    .not-found h2 {
        color: var(--body-fg, #333);
        margin-top: 0;
        border-bottom: none;
    }
    .not-found p {
        color: var(--body-quiet-color, #666);
    }
    .submit-row {
        padding: 12px 0;
        margin: 20px 0 0 0;
        border-top: 1px solid var(--hairline-color, #e8e8e8);
    }
    .submit-row a {
        display: inline-block;
        background: var(--default-button-bg, #417690);
        color: var(--button-fg, #fff);
        padding: 10px 15px;
        border-radius: 4px;
        text-decoration: none;
        font-weight: 400;
    }
    .submit-row a:hover {
        background: var(--default-button-hover-bg, #205067);
    }

    /* Dark mode specific adjustments */
    @media (prefers-color-scheme: dark) {
        .status-READY,
        .status-RUNNING,
        .status-SUCCESSFUL,
        .status-FAILED {
            opacity: 0.9;
        }
    }

    html[data-theme="dark"] .status-READY,
    html[data-theme="dark"] .status-RUNNING,
    html[data-theme="dark"] .status-SUCCESSFUL,
    html[data-theme="dark"] .status-FAILED {
        opacity: 0.9;
    }
</style>

{% if task %}
<div class="task-detail">
    <h2>{% trans "Task Information" %}</h2>
    <table>
        <tr>
            <th>{% trans "Task ID" %}</th>
            <td><code>{{ task.task_id }}</code></td>
        </tr>
        <tr>
            <th>{% trans "Task Path" %}</th>
            <td><code>{{ task.task_path }}</code></td>
        </tr>
        <tr>
            <th>{% trans "Status" %}</th>
            <td><span class="status-badge status-{{ task.status }}">{{ task.status }}</span></td>
        </tr>
        <tr>
            <th>{% trans "Priority" %}</th>
            <td>{{ task.priority }}</td>
        </tr>
        <tr>
            <th>{% trans "Queue Name" %}</th>
            <td>{{ task.queue_name }}</td>
        </tr>
        <tr>
            <th>{% trans "Backend" %}</th>
            <td>{{ task.backend_name|default:"default" }}</td>
        </tr>
    </table>

    <h2>{% trans "Timestamps" %}</h2>
    <table>
        <tr>
            <th>{% trans "Enqueued At" %}</th>
            <td>{{ task.enqueued_at|default:"-" }}</td>
        </tr>
        <tr>
            <th>{% trans "Run After" %}</th>
            <td>{{ task.run_after|default:"-" }}</td>
        </tr>
        <tr>
            <th>{% trans "Started At" %}</th>
            <td>{{ task.started_at|default:"-" }}</td>
        </tr>
        <tr>
            <th>{% trans "Finished At" %}</th>
            <td>{{ task.finished_at|default:"-" }}</td>
        </tr>
    </table>

    <h2>{% trans "Arguments" %}</h2>
    <table>
        <tr>
            <th>{% trans "Args" %}</th>
            <td>
                {% if task.args_json %}
                <div class="json-content">{{ task.args_json }}</div>
                {% else %}
                <span class="empty-value">{% trans "None" %}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>{% trans "Kwargs" %}</th>
            <td>
                {% if task.kwargs_json %}
                <div class="json-content">{{ task.kwargs_json }}</div>
                {% else %}
                <span class="empty-value">{% trans "None" %}</span>
                {% endif %}
            </td>
        </tr>
    </table>

    {% if task.status == 'SUCCESSFUL' %}
    <h2>{% trans "Return Value" %}</h2>
    <table>
        <tr>
            <th>{% trans "Result" %}</th>
            <td>
                <div class="json-content">{{ task.return_value_json }}</div>
            </td>
        </tr>
    </table>
    {% endif %}

    {% if task.status == 'FAILED' and task.errors_json %}
    <h2>{% trans "Error Information" %}</h2>
    <table>
        <tr>
            <th>{% trans "Errors" %}</th>
            <td>
                <div class="error-content">{{ task.errors_json }}</div>
            </td>
        </tr>
    </table>
    {% endif %}

    {% if task.worker_ids_json %}
    <h2>{% trans "Worker Information" %}</h2>
    <table>
        <tr>
            <th>{% trans "Worker IDs" %}</th>
            <td>{{ task.worker_ids_json }}</td>
        </tr>
    </table>
    {% endif %}
</div>
{% else %}
<div class="task-detail not-found">
    <h2>{% trans "Task Not Found" %}</h2>
    <p>{% trans "The task with ID" %} <code>{{ task_id }}</code> {% trans "was not found." %}</p>
</div>
{% endif %}

<div class="submit-row">
    <a href="{% url 'admin:django_tasks_redis_redistask_changelist' %}">&larr; {% trans "Back to Task List" %}</a>
</div>
{% endblock %}
